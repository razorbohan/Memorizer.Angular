<alert-message [message]="message"></alert-message>

<div class="row">
	<div class="summary">
		<span>Level: {{currentMemo ? currentMemo.postponeLevel : 0}}, </span>
		<span>Scores: {{currentMemo ? currentMemo.scores : 0}} </span>
	</div>
</div>

<textarea class="col-12" [ngModel]="currentMemo?.question" (ngModelChange)="currentMemo.question=$event"
	(focus)="showUpdateGroup(true)" (blur)="showUpdateGroup(false)"></textarea>

<div class="row justify-content-around my-2 text-nowrap">
	<div class="col-3 d-flex justify-content-center align-items-center">
		<span>Overall: {{count}}</span>
	</div>
	<div class="col-3 d-flex justify-content-center">
		<button class="btn btn-outline-primary" (click)="showAnswer()">Show</button>
	</div>
	<div class="col-3 d-flex justify-content-center update-group">
		<div class="btn-group" (mouseenter)="isFocused=true" (mouseleave)="isFocused=false">
			<button class="btn btn-outline-secondary" *ngIf="isShowUpdateGroup || isFocused" (click)="replaceMemos()"
				type="button">
				<i class="fa fa-exchange"></i>
			</button>
			<button class="btn btn-outline-primary" *ngIf="isShowUpdateGroup || isFocused" (click)="updateMemo()"
				type="button">
				<i class="far fa-save"></i>
			</button>
			<button class="btn btn-outline-danger" (click)="deleteMemo()" type="button">
				<i class="fas fa-trash-alt"></i>
			</button>
		</div>
	</div>
</div>

<div @fade *ngIf="isShowAnswer">
	<textarea class="col-12" (focus)="showUpdateGroup(true)" (blur)="showUpdateGroup(false)"
		[ngModel]="currentMemo?.answer" (ngModelChange)="currentMemo.answer=$event"></textarea>

	<div class="row">
		<div class="mx-auto my-2">
			<div class="answer-group btn-group">
				<button *ngIf="mode == 'Repeat'" class="btn btn-danger" (click)="submitAnswer('Bad')">Bad</button>
				<button *ngIf="mode == 'Repeat'" class="btn btn-warning"
					(click)="submitAnswer('Tomorrow')">Tomorrow</button>
				<button class="btn btn-primary" (click)="submitAnswer('Later')">Later</button>
				<button class="btn btn-success" (click)="submitAnswer('Cool')">Cool</button>
			</div>
		</div>
	</div>
</div>

<!-- <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

	<ng-container matColumnDef="position">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> No. </th>
		<td mat-cell *matCellDef="let element"> {{element.position}} </td>
	</ng-container>

	<ng-container matColumnDef="name">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
		<td mat-cell *matCellDef="let element"> {{element.name}} </td>
	</ng-container>

	<ng-container matColumnDef="weight">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> Weight </th>
		<td mat-cell *matCellDef="let element"> {{element.weight}} </td>
	</ng-container>

	<ng-container matColumnDef="symbol">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> Symbol </th>
		<td mat-cell *matCellDef="let element"> {{element.symbol}} </td>
	</ng-container>

	<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
	<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table> -->

<mat-form-field class="findInput">
	<input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter...">
</mat-form-field>

<table mat-table matSort [dataSource]="dataSource" class="mat-elevation-z8">
	<ng-container matColumnDef="id">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
		<td mat-cell *matCellDef="let element"> {{element.id}} </td>
	</ng-container>

	<ng-container matColumnDef="question">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> Question </th>
		<td mat-cell *matCellDef="let element;let index=index">
			<editable (update)="updateField(index, element, 'question')">
				<ng-template viewMode>
					{{element.question}}
				</ng-template>
				<ng-template editMode>
					<mat-form-field>
						<input matInput editableOnEnter [formControl]="getControl(index, 'question')">
						<mat-error *ngIf="getControl(index, 'question').hasError('required')">
							Field is <strong>required</strong>
						</mat-error>
					</mat-form-field>
				</ng-template>
			</editable>
		</td>
	</ng-container>

	<ng-container matColumnDef="answer">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> Answer </th>
		<td mat-cell *matCellDef="let element;let index=index">
			<editable (update)="updateField(index, element, 'answer')">
				<ng-template viewMode>
					{{element.answer}}
				</ng-template>
				<ng-template editMode>
					<mat-form-field>
						<input matInput editableOnEnter [formControl]="getControl(index, 'answer')">
						<mat-error *ngIf="getControl(index, 'answer').hasError('required')">
							Field is <strong>required</strong>
						</mat-error>
					</mat-form-field>
				</ng-template>
			</editable>
		</td>
	</ng-container>

	<ng-container matColumnDef="repeatDate">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> Repeat date </th>
		<td mat-cell *matCellDef="let element;let index=index">
			<editable (update)="updateField(index, element, 'repeatDate')">
				<ng-template viewMode>
					{{element.repeatDate | date:'dd.MM.yyyy'}}
				</ng-template>
				<ng-template editMode>
					<mat-form-field>
						<input matInput [matDatepicker]="picker" [formControl]="getControl(index, 'repeatDate')">
						<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
						<mat-datepicker #picker></mat-datepicker>
						<mat-error *ngIf="getControl(index, 'repeatDate').hasError('required')">
							Field is <strong>required</strong>
						</mat-error>
						<mat-error *ngIf="getControl(index, 'postponeLevel').hasError('dateVaidator')">
							Field must be a <strong>Date</strong>
						</mat-error>
					</mat-form-field>
				</ng-template>
			</editable>
		</td>
	</ng-container>

	<ng-container matColumnDef="postponeLevel">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> LVL </th>
		<td mat-cell *matCellDef="let element;let index=index">
			<editable (update)="updateField(index, element, 'postponeLevel')">
				<ng-template viewMode>
					{{element.postponeLevel}}
				</ng-template>
				<ng-template editMode>
					<mat-form-field>
						<mat-select [formControl]="getControl(index, 'postponeLevel')">
							<mat-option *ngFor="let lvl of this.levels" [value]="lvl">
								{{lvl}}
							</mat-option>
						</mat-select>
						<mat-error *ngIf="getControl(index, 'postponeLevel').hasError('required')">
							Field is <strong>required</strong>
						</mat-error>
					</mat-form-field>
				</ng-template>
			</editable>
		</td>
	</ng-container>

	<ng-container matColumnDef="scores">
		<th mat-header-cell *matHeaderCellDef mat-sort-header> Scores </th>
		<td mat-cell *matCellDef="let element;let index=index">
			<editable (update)="updateField(index, element, 'scores')">
				<ng-template viewMode>
					{{element.scores}}
				</ng-template>
				<ng-template editMode>
					<mat-form-field>
						<input type="number" matInput editableOnEnter [formControl]="getControl(index, 'scores')">
						<mat-error *ngIf="getControl(index, 'scores').hasError('required')">
							Field is <strong>required</strong>
						</mat-error>
					</mat-form-field>
				</ng-template>
			</editable>
		</td>
	</ng-container>

	<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
	<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>

<mat-paginator [pageSize]="10" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons
	[ngStyle]="{'visibility':isLoading ? 'hidden' : 'visible'}">
</mat-paginator>

<memo-loader [isLoading]="isLoading"></memo-loader>